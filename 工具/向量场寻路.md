---
tags:
  - 寻路算法
aliases:
time: 2025-12-31
---
**向量场寻路是一种用于大规模、高密度单位（如RTS游戏中的百人军队）同时寻路的群体运动技术。它的核心思想是：不为每个单位单独计算路径，而是为整个地图或区域计算一个统一的、指示移动方向的“向量场”，所有单位只需根据自己所在位置的向量方向移动即可。**

简单来说，它把寻路问题从 **“计算一条线”** 转变为 **“计算一个布满箭头的场”** ，每个单位都是场中遵循箭头指引的粒子。

下图清晰地展示了向量场寻路的基本工作原理：
### 技术原理详解

1. **生成全局流向**
    
    - 系统会使用一次A*算法，计算出从**群体平均起点**到**目标区域**的一条或多条主干路径。
        
    - 然后，以这条主干路径为中心，向周围扩散生成一个**梯度场**。离理想路径越近的地方，指向目标的向量就越强、越直接；离得越远，向量会逐渐偏向，将单位“拉回”主路径。
        
2. **融入局部避障**
    
    - 这是向量场寻路动态性的关键。场景中的每个障碍物（如树木、建筑）都会向外施加一个**排斥向量**（类似磁铁的同极相斥）。
        
    - 最终，地图上每一个点的**合成向量**，都是由 **“目标吸引力”** 和周围所有 **“障碍排斥力”** 叠加计算得出的。单位靠近障碍物时，排斥力会主导方向，使其自然绕行。

# 核心优势（为何要使用它？）

与为每个单位单独跑A*的传统方式相比，向量场寻路在特定场景下优势巨大：

- **极高的性能**：无论有100个还是1000个单位，**全局向量场只需计算一次**，之后所有单位共享结果。CPU开销与单位数量几乎无关，完美解决RTS游戏中“框选百人军队进攻”的卡顿问题。
    
- **自然的群体行为**：向量场天然会产生流畅、宏观的群体运动效果，如：
    
    - **分流与合流**：遇到狭窄路口时，队伍会自动分成两股通过，再重新合并。
        
    - **绕过障碍**：遇到障碍物时，队伍会像水流一样从两侧绕过，而不是每个单位挤撞同一点。
        
    - **保持队形**：通过调整向量场，可以粗略地保持进攻阵型。
        
- **动态响应**：当新障碍出现（如新建了一个建筑），只需更新该障碍物周围的局部向量场，整个系统就能快速适应。

### 局限性

- **非精确路径**：它提供的是**方向指引**，而非精确到像素的路径。单个单位可能走出轻微的“之”字形或弧线，不适用于要求严格走格的游戏。
    
- **局部死锁**：在极端复杂的地形中，排斥力可能相互抵消，导致某些点出现“零向量”（单位停滞），需要额外逻辑处理。
    
- **计算开销前置**：生成高质量的全局向量场本身计算量较大，适合静态或半静态环境。在完全动态变化的环境中，频繁更新全场可能得不偿失。

![](assets/向量场寻路/file-20251231132600191.png)